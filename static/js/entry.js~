// this is the javascript for the data entry page
// template at templates/head/entry.html

cursor_accession_number = max_accession_number;

function incAccNo(){
    // increases accession number by 1 and all the other vars dependent on current accNo
    max_accession_number += 1;
    cursor_accession_number += 1;
}

function getData(){
    // get data from entry system
    data = [];
    
    for (i=0;i < cols_table.length;i++){
        if (cols_table[i][1][2] == "acc_no")
	    data.push(max_accession_number);
	else{
	    data.push($("."+cols_table[i][1][2]).val());
	}
    }
    incAccNo();
    return data;
}


function saveData(){
    return true
}


$(".input").on("keypress", function(e){
    if (e.keyCode == 38){
	cursor_accession_number -= 1;
	var tr = $("#"+cursor_accession_number).children();
	var data = [];
	var tc = $("#" + cursor_accession_number).children();
	for (i=0;i < tc.length; i++){
	    console.log(cols_table[i][1][2]);
	    data.push(tc[i].textContent);
	    data.push();
	}
	console.log(data);
    }
    if (e.shiftKey && e.keyCode == 37){
	if (e.currentTarget.id == "1"){
	    e.preventDefault();
	    document.getElementById(total_cols_entry.toString()).focus();
	}
	else{
	    e.preventDefault();
	    document.getElementById((parseInt(e.currentTarget.id, 10)-1).toString()).focus();
	}
    }

    else if (e.shiftKey && e.keyCode == 39){
	if (e.currentTarget.id == total_cols_entry.toString()){
	    e.preventDefault();
	    document.getElementById("1").focus();
	}
	else{
	    e.preventDefault();
	    document.getElementById((parseInt(e.currentTarget.id, 10)+1).toString()).focus();
	}
    }
    
    if ( e.keyCode == 13 ){
	if (saveData() == true){
	    var data = "";
	    var accession_number = max_accession_number;
	    var input_array = getData();
	    for (i=0;i < input_array.length;i++){
		if (input_array[i] == "")
		    data += "<td id='"+ cols_table[i][1][2] +"'> Not Given </td>";
		else
		    data += "<td id='"+cols_table[i][1][2]+"'>" + input_array[i] + "</td>";
	    }
	    $("#table > tbody").append('<tr id="'+accession_number+'">'+data+"</tr>");
	}
    }
})


$("#"+total_cols_entry.toString()).on('keypress', function(e){
    if (e.keyCode == 9){
	e.preventDefault();
	document.getElementById("1").focus();
    }
    if ( e.shiftKey && ( e.keyCode == 9 ) ){
	e.preventDefault();
	document.getElementById((total_cols_entry - 1).toString()).focus();
    }
    
});

$("#1").on('keypress', function(e){
    if (e.shiftKey && ( e.keyCode == 9 ))
    {
	e.preventDefault();
	document.getElementById(total_cols_entry.toString()).focus();
    }
})
